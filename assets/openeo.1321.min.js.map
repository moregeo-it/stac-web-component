{"version":3,"file":"openeo.1321.min.js","mappings":"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","sources":["webpack://vue-lib-openeo/./node_modules/@radiantearth/stac-migrate/migrate.js","webpack://vue-lib-openeo/./node_modules/@radiantearth/stac-migrate/node_modules/compare-versions/index.js"],"sourcesContent":["// Migration rules partly based on PySTAC and @openeo/js-commons,\n// see https://github.com/stac-utils/pystac/tree/v0.5.4/pystac/serialization/migrate.py\n// and https://github.com/Open-EO/openeo-js-commons/tree/v1.2.0/src/migrate/collections.js\n\nvar compareVersions = require('compare-versions');\n\nconst LATEST_VERSION = '1.1.0';\nconst DONE = true; // This is used to verify in code coverage whether something has been used or not\nconst SCHEMAS = {\n  'classification': 'https://stac-extensions.github.io/classification/v2.0.0/schema.json',\n  'datacube': 'https://stac-extensions.github.io/datacube/v2.2.0/schema.json',\n  'eo': 'https://stac-extensions.github.io/eo/v2.0.0/schema.json',\n  'file': 'https://stac-extensions.github.io/file/v2.1.0/schema.json',\n  'item-assets': 'https://stac-extensions.github.io/item-assets/v1.0.0/schema.json',\n  'label': 'https://stac-extensions.github.io/label/v1.0.1/schema.json',\n  'pointcloud': 'https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json',\n  'processing': 'https://stac-extensions.github.io/processing/v1.2.0/schema.json',\n  'projection': 'https://stac-extensions.github.io/projection/v2.0.0/schema.json',\n  'raster': 'https://stac-extensions.github.io/raster/v2.0.0/schema.json',\n  'sar': 'https://stac-extensions.github.io/sar/v1.0.0/schema.json',\n  'sat': 'https://stac-extensions.github.io/sat/v1.0.0/schema.json',\n  'scientific': 'https://stac-extensions.github.io/scientific/v1.0.0/schema.json',\n  'table': 'https://stac-extensions.github.io/table/v1.2.0/schema.json',\n  'timestamps': 'https://stac-extensions.github.io/timestamps/v1.1.0/schema.json',\n  'version': 'https://stac-extensions.github.io/version/v1.2.0/schema.json',\n  'view': 'https://stac-extensions.github.io/view/v1.0.0/schema.json'\n};\nconst EXTENSIONS = {\n  // Add a : at the end to indicate it has a prefix, otherwise list all fields separately (see version extension for example).\n  itemAndCollection: {\n    // with prefix\n    'classification:': SCHEMAS.classification,\n    'cube:': SCHEMAS.datacube,\n    'eo:': SCHEMAS.eo,\n    'file:': SCHEMAS.file,\n    'label:': SCHEMAS.label,\n    'pc:': SCHEMAS.pointcloud,\n    'processing:': SCHEMAS.processing,\n    'proj:': SCHEMAS.projection,\n    'raster:': SCHEMAS.raster,\n    'sar:': SCHEMAS.sar,\n    'sat:': SCHEMAS.sat,\n    'sci:': SCHEMAS.scientific,\n    'view:': SCHEMAS.view,\n    // without prefix\n    'version': SCHEMAS.version,\n    'deprecated': SCHEMAS.version,\n    'published': SCHEMAS.timestamps,\n    'expires': SCHEMAS.timestamps,\n    'unpublished': SCHEMAS.timestamps\n  },\n  catalog: {\n    // None yet\n  },\n  collection: {\n    // None yet\n  },\n  item: {\n    // None yet\n  },\n};\nEXTENSIONS.collection = Object.assign(EXTENSIONS.collection, EXTENSIONS.itemAndCollection);\nEXTENSIONS.item = Object.assign(EXTENSIONS.item, EXTENSIONS.itemAndCollection);\n\nvar Ext = {\n  parseExtension(url) {\n    // Try to match name and version from official extensions\n    let match = url.match(/^https?:\\/\\/stac-extensions.github.io\\/([^\\/]+)\\/v([^\\/]+)\\/[^.]+.json$/i);\n    if (match) {\n      return {\n        id: match[1],\n        version: match[2]\n      };\n    }\n    // Try to match version from URIs\n    let match2 = url.match(/(\\d+\\.\\d+(\\.\\d+)([a-z_.-][\\w.-]+)?)/i);\n    if (match2) {\n      return {\n        id: url,\n        version: match2[1]\n      };\n    }\n    // Handle schortnames\n    if (url in SCHEMAS) {\n      return {\n        id: url,\n        version: '0.0.0'\n      };\n    }\n  }\n};\n\nvar V = {\n  version: LATEST_VERSION,\n  extensions: {},\n\n  set(stac) {\n    if (typeof stac.stac_version !== 'string') {\n      V.version = '0.6.0'; // Assume the worst case, it doesn't seem there's a clear indicator for 0.7.0\n    }\n    else {\n      V.version = stac.stac_version;\n    }\n\n    if (Array.isArray(stac.stac_extensions)) {\n      for (let ext of stac.stac_extensions) {\n        let e = Ext.parseExtension(ext);\n        if (e) {\n          V.extensions[e.id] = e.version;\n        }\n      }\n    }\n  },\n\n  before(version, ext = null) {\n    return V.compare('<', version, ext);\n  },\n\n  compare(comparator, version, ext = null) {\n    let compareTo = ext ? V.extensions[ext] : V.version;\n    if (typeof compareTo === 'undefined') {\n      return false;\n    }\n    else {\n      return compareVersions.compare(compareTo, version, comparator);\n    }\n  }\n\n};\n\nvar _ = {\n\n  type(val) {\n    let type = typeof val;\n    if (type === 'object') {\n      if (val === null) {\n        return 'null';\n      }\n      else if (Array.isArray(val)) {\n        return 'array';\n      }\n    }\n    return type;\n  },\n\n  is(val, type) {\n    if (Array.isArray(type)) {\n      return type.includes(_.type(val));\n    }\n    else {\n      return _.type(val) === type;\n    }\n  },\n\n  isDefined(val) {\n    return (typeof val !== 'undefined');\n  },\n\n  isObject(obj) {\n    return (typeof obj === 'object' && obj === Object(obj) && !Array.isArray(obj));\n  },\n\n  rename(obj, oldKey, newKey) {\n    if (typeof obj[oldKey] !== 'undefined' && typeof obj[newKey] === 'undefined') {\n      obj[newKey] = obj[oldKey];\n      delete obj[oldKey];\n      return true;\n    }\n    return false;\n  },\n\n  copy(obj, oldKey, newKey) {\n    if (typeof obj[oldKey] !== 'undefined' && typeof obj[newKey] === 'undefined') {\n      obj[newKey] = obj[oldKey];\n      return true;\n    }\n    return false;\n  },\n\n  forAll(obj, key, fn) {\n    if (obj[key] && typeof obj[key] === 'object') {\n      for (let i in obj[key]) {\n        fn(obj[key][i]);\n      }\n    }\n  },\n\n  toArray(obj, key) {\n    if (typeof obj[key] !== 'undefined' && !Array.isArray(obj[key])) {\n      obj[key] = [obj[key]];\n      return true;\n    }\n    return false;\n  },\n\n  flattenArray(obj, key, newKeys, summary = false) {\n    if (Array.isArray(obj[key])) {\n      for (let i in obj[key]) {\n        if (typeof newKeys[i] === 'string') {\n          let value = obj[key][i];\n          obj[newKeys[i]] = summary ? [value] : value;\n        }\n      }\n      delete obj[key];\n      return true;\n    }\n    return false;\n  },\n\n  flattenOneElementArray(obj, key, summary = false) {\n    if (!summary && Array.isArray(obj[key])) {\n      if (obj[key].length === 1) {\n        obj[key] = obj[key][0];\n        return true;\n      }\n      else {\n        return false; // It's still an array and we don't know which element to choose\n      }\n    }\n    return true; // It's already a single element\n  },\n\n  removeFromArray(obj, key, valueToRemove) {\n    if (Array.isArray(obj[key])) {\n      let index = obj[key].indexOf(valueToRemove);\n      if (index > -1) {\n        obj[key].splice(index, 1);\n      }\n      return true;\n    }\n    return false;\n  },\n\n  pickFirst(obj, key) {\n    if (Array.isArray(obj[key]) && obj[key].length > 0) {\n      obj[key] = obj[key][0];\n      return true;\n    }\n    else {\n      delete obj[key];\n      return false;\n    }\n  },\n\n  ensure(obj, key, defaultValue) {\n    if (_.type(defaultValue) !== _.type(obj[key])) {\n      obj[key] = defaultValue;\n    }\n    return true;\n  },\n\n  upgradeExtension(context, extension) {\n    let { id, version } = Ext.parseExtension(extension);\n    let index = context.stac_extensions.findIndex(url => {\n      let old = Ext.parseExtension(url);\n      return (old && old.id === id && compareVersions.compare(old.version, version, '<'));\n    });\n    if (index !== -1) {\n      context.stac_extensions[index] = extension;\n      return true;\n    }\n    else {\n      return false;\n    }\n  },\n\n  addExtension(context, newExtension) {\n    let { id, version } = Ext.parseExtension(newExtension);\n    let index = context.stac_extensions.findIndex(url => {\n      if (url === newExtension) {\n        return true;\n      }\n      let old = Ext.parseExtension(url);\n      if (old && old.id === id && compareVersions.compare(old.version, version, '<')) {\n        return true;\n      }\n      return false;\n    });\n    if (index === -1) {\n      context.stac_extensions.push(newExtension);\n    }\n    else {\n      context.stac_extensions[index] = newExtension;\n    }\n\n    context.stac_extensions.sort();\n    return true;\n  },\n\n  removeExtension(context, oldExtension) {\n    return _.removeFromArray(context, 'stac_extensions', oldExtension);\n  },\n\n  migrateExtensionShortnames(context) {\n    let oldShortnames = Object.keys(SCHEMAS);\n    let newSchemas = Object.values(SCHEMAS);\n    return _.mapValues(context, 'stac_extensions', oldShortnames, newSchemas);\n  },\n\n  populateExtensions(context, type) {\n    let objectsToCheck = [];\n    if (type == 'catalog' || type == 'collection') {\n      objectsToCheck.push(context);\n    }\n    if ((type == 'item' || type == 'collection') && _.isObject(context.assets)) {\n      objectsToCheck = objectsToCheck.concat(Object.values(context.assets));\n    }\n    if (type == 'collection' && _.isObject(context.item_assets)) {\n      objectsToCheck = objectsToCheck.concat(Object.values(context.item_assets));\n    }\n    if (type == 'collection' && _.isObject(context.summaries)) {\n      objectsToCheck.push(context.summaries);\n    }\n    if (type == 'item' && _.isObject(context.properties)) {\n      objectsToCheck.push(context.properties);\n    }\n    objectsToCheck.push(context.links);\n\n    let obj;\n    while(obj = objectsToCheck.pop()) {\n      Object.keys(obj).forEach(key => {\n        // Add additional objects to check\n        if (Array.isArray(obj.bands)) {\n          objectsToCheck = objectsToCheck.concat(obj.bands);\n        }\n\n        // Check for fields with extension prefixes\n        let prefix = key.match(/^(\\w+:|[^:]+$)/i);\n        if (Array.isArray(prefix)) {\n          let ext = EXTENSIONS[type][prefix[0]];\n          _.is(ext, 'string') && _.addExtension(context, ext) && DONE;\n        }\n      });\n    }\n  },\n\n  mapValues(obj, key, oldValues, newValues) {\n    let fn = value => {\n      let index = oldValues.indexOf(value);\n      if (index >= 0) {\n        return newValues[index];\n      }\n      return value;\n    };\n    if (Array.isArray(obj[key])) {\n      obj[key] = obj[key].map(fn);\n    }\n    else if (typeof obj[key] !== 'undefined') {\n      obj[key] = fn(obj[key]);\n    }\n    return true;\n  },\n\n  mapObject(obj, fn) {\n    for (let key in obj) {\n      obj[key] = fn(obj[key], key);\n    }\n  },\n\n  moveTo(obj, key, context, fromSummary = false, mergedSummary = false) {\n    let condition;\n    if (fromSummary) {\n      if (mergedSummary) {\n        condition = val => Array.isArray(val);\n      }\n      else {\n        condition = val => Array.isArray(val) && val.length === 1;\n      }\n    }\n    else {\n      condition = _.isDefined\n    }\n    if (condition(obj[key])) {\n      context[key] = fromSummary && !mergedSummary ? obj[key][0] : obj[key];\n      delete obj[key];\n      return true;\n    }\n    return false;\n  },\n\n  runAll(migrations, obj, context, summaries) {\n    for (let fn in migrations) {\n      if (!fn.startsWith('migrate')) {\n        migrations[fn](obj, context, summaries);\n      }\n    }\n  },\n\n  toUTC(obj, key) {\n    if (_.is(obj[key], 'string')) {\n      try {\n        obj[key] = this.toISOString(obj[key]);\n        return true;\n      } catch (error) { }\n    }\n    delete obj[key];\n    return false;\n  },\n\n  toISOString(date) {\n    if (!(date instanceof Date)) {\n      date = new Date(date);\n    }\n    return date.toISOString().replace(/\\.0+(?=[-\\+Z])/, ''); // Don't export milliseconds if not needed\n  },\n\n  formatString(obj, key, format) {\n    const formatter = value => {\n      if (_.is(value, ['string', 'number'])) {\n        return format.replaceAll('{}', value);\n      }\n      return value;\n    };\n    if (Array.isArray(obj[key])) {\n      obj[key] = obj[key].map(formatter);\n    }\n    else {\n      obj[key] = formatter(obj[key]);\n    }\n  }\n\n};\n\nvar Checksum = {\n\n  multihash: null,\n\n  hexToUint8(hexString) {\n    if (hexString.length === 0 || hexString.length % 2 !== 0) {\n      throw new Error(`The string \"${hexString}\" is not valid hex.`)\n    }\n    return new Uint8Array(hexString.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));\n  },\n\n  uint8ToHex(bytes) {\n    return bytes.reduce((str, byte) => str + byte.toString(16).padStart(2, '0'), '');\n  },\n\n  toMultihash(obj, key, algo) {\n    if (!Checksum.multihash || !_.is(obj[key], 'string')) {\n      return false;\n    }\n    try {\n      const encoded = Checksum.multihash.encode(Checksum.hexToUint8(obj[key]), algo);\n      obj[key] = Checksum.uint8ToHex(encoded);\n      return true;\n    } catch (error) {\n      console.warn(error);\n      return false;\n    }\n  }\n\n};\n\nvar Catalog = {\n\n  migrate(catalog, updateVersionNumber = true) {\n    V.set(catalog);\n    if (updateVersionNumber) {\n      catalog.stac_version = LATEST_VERSION;\n    }\n    catalog.type = 'Catalog';\n\n    _.ensure(catalog, 'stac_extensions', []) && DONE;\n    V.before('1.0.0-rc.1') && _.migrateExtensionShortnames(catalog) && DONE;\n\n    _.ensure(catalog, 'id', '') && DONE;\n    _.ensure(catalog, 'description', '') && DONE;\n    _.ensure(catalog, 'links', []) && DONE;\n\n    _.runAll(Catalog, catalog, catalog);\n\n    V.before('0.8.0') && _.populateExtensions(catalog, 'catalog') && DONE;\n\n    return catalog;\n  },\n\n};\n\nvar Collection = {\n\n  migrate(collection, updateVersionNumber = true) {\n    Catalog.migrate(collection, updateVersionNumber); // Migrates stac_version, stac_extensions, id, title, description, links\n    collection.type = 'Collection';\n\n    V.before('1.0.0-rc.1') && _.migrateExtensionShortnames(collection) && DONE;\n\n    _.ensure(collection, 'license', 'other') && DONE;\n    _.ensure(collection, 'extent', {\n      spatial: {\n        bbox: []\n      },\n      temporal: {\n        interval: []\n      }\n    }) && DONE;\n\n    _.runAll(Collection, collection, collection);\n\n    // Migrate Commons extension - part 3\n    if (_.isObject(collection.properties)) {\n      _.removeFromArray(collection, 'stac_extensions', 'commons') && DONE;\n      delete collection.properties;\n    }\n\n    V.before('0.8.0') && _.populateExtensions(collection, 'collection') && DONE;\n    V.before('1.0.0-beta.1') && _.mapValues(collection, 'stac_extensions', ['assets'], ['item-assets']) && DONE;\n\n    return collection;\n  },\n\n  extent(collection) {\n    _.ensure(collection, \"extent\", {});\n\n    if (V.before('0.8.0')) {\n      // Restructure spatial extent\n      if (Array.isArray(collection.extent.spatial)) {\n        collection.extent.spatial = {\n          bbox: [\n            collection.extent.spatial\n          ]\n        };\n      }\n      // Restructure temporal extent\n      if (Array.isArray(collection.extent.temporal)) {\n        collection.extent.temporal = {\n          interval: [\n            collection.extent.temporal\n          ]\n        };\n      }\n    }\n\n    _.ensure(collection.extent, \"spatial\", {});\n    _.ensure(collection.extent.spatial, \"bbox\", []);\n    _.ensure(collection.extent, \"temporal\", {});\n    _.ensure(collection.extent.temporal, \"interval\", []);\n\n    if (V.before('1.0.0-rc.3')) {\n      // The first extent in a Collection is always the overall extent, followed by more specific extents.\n      if (collection.extent.temporal.interval.length > 1) {\n        let min, max;\n        for (let interval of collection.extent.temporal.interval) {\n          if (interval[0] === null) {\n            min = null;\n          }\n          else if (typeof interval[0] === 'string' && min !== null) {\n            try {\n              let start = new Date(interval[0]);\n              if (typeof min === 'undefined' || start < min) {\n                min = start;\n              }\n            } catch (error) { }\n          }\n\n          if (interval[1] === null) {\n            max = null;\n          }\n          else if (typeof interval[1] === 'string' && max !== null) {\n            try {\n              let end = new Date(interval[1]);\n              if (typeof max === 'undefined' || end > max) {\n                max = end;\n              }\n            } catch (error) { }\n          }\n        }\n        collection.extent.temporal.interval.unshift([\n          min ? _.toISOString(min) : null,\n          max ? _.toISOString(max) : null\n        ]);\n      }\n      if (collection.extent.spatial.bbox.length > 1) {\n        let count = collection.extent.spatial.bbox.reduce((val, bbox) => Array.isArray(bbox) ? Math.max(bbox.length, val) : val, 4);\n        if (count >= 4) {\n          let union = new Array(count).fill(null);\n          let middle = count / 2;\n          for (let bbox of collection.extent.spatial.bbox) {\n            if (!Array.isArray(bbox) || bbox.length < 4) {\n              break;\n            }\n            for (let i in bbox) {\n              let c = bbox[i];\n              if (union[i] === null) {\n                union[i] = c;\n              }\n              else if (i < middle) {\n                union[i] = Math.min(c, union[i]);\n              }\n              else {\n                union[i] = Math.max(c, union[i]);\n              }\n\n            }\n          }\n          if (union.findIndex(c => c === null) === -1) {\n            collection.extent.spatial.bbox.unshift(union);\n          }\n        }\n      }\n    }\n  },\n\n  collectionAssets(collection) {\n    V.before('1.0.0-rc.1') && _.removeExtension(collection, 'collection-assets') && DONE;\n\n    Asset.migrateAll(collection);\n  },\n\n  itemAsset(collection) {\n    V.before('1.0.0-beta.2') && _.rename(collection, 'item_assets', 'assets');\n\n    _.removeExtension(collection, SCHEMAS['item-assets']) && DONE;\n\n    Asset.migrateAll(collection, 'item_assets');\n  },\n\n  summaries(collection) {\n    _.ensure(collection, 'summaries', {});\n\n    // other_properties: An early version of the Collection summaries with a similar structure\n    // Was mostly used in standalone collections from openEO and GEE. Move other_properties to summaries.\n    if (V.before('0.8.0') && _.isObject(collection.other_properties)) {\n      for (let key in collection.other_properties) {\n        let prop = collection.other_properties[key];\n        if (Array.isArray(prop.extent) && prop.extent.length === 2) {\n          collection.summaries[key] = {\n            minimum: prop.extent[0],\n            maximum: prop.extent[1],\n          };\n        }\n        else if (Array.isArray(prop.values)) {\n          if (prop.values.filter(v => Array.isArray(v)).length === prop.values.length) {\n            // If it is an array of arrays, merge the arrays\n            collection.summaries[key] = prop.values.reduce((a, b) => a.concat(b), []);\n          }\n          else {\n            collection.summaries[key] = prop.values;\n          }\n        }\n      }\n      delete collection.other_properties;\n    }\n\n    // Migrate Commons extension - part 2\n    // Move properties to (single element) summaries if the Collection is standalone\n    // see also https://github.com/stac-utils/stac-migrate/issues/3\n    if (V.before('1.0.0-beta.1') && _.isObject(collection.properties) && !collection.links.find(link => ['child', 'item'].includes(link.rel))) {\n      for (let key in collection.properties) {\n        let value = collection.properties[key];\n        if (!Array.isArray(value)) {\n          value = [value];\n        }\n        collection.summaries[key] = value;\n      }\n    }\n\n    if (V.before('1.0.0-rc.1')) {\n      _.mapObject(collection.summaries, val => {\n        _.rename(val, 'min', 'minimum') && DONE;\n        _.rename(val, 'max', 'maximum') && DONE;\n        return val;\n      });\n    }\n\n    // now we can work on all summaries and migrate them\n    Fields.migrate(collection.summaries, collection, true);\n\n    // Some fields should usually be on root-level if there's only one element\n    _.moveTo(collection.summaries, 'sci:doi', collection, true) && _.addExtension(collection, SCHEMAS.scientific) && DONE;\n    _.moveTo(collection.summaries, 'sci:publications', collection, true, true) && _.addExtension(collection, SCHEMAS.scientific) && DONE;\n    _.moveTo(collection.summaries, 'sci:citation', collection, true) && _.addExtension(collection, SCHEMAS.scientific) && DONE;\n    _.moveTo(collection.summaries, 'cube:dimensions', collection, true) && _.addExtension(collection, SCHEMAS.datacube) && DONE;\n\n    // Remove summary field if empty\n    if (Object.keys(collection.summaries).length === 0) {\n      delete collection.summaries;\n    }\n  }\n\n};\n\nvar Item = {\n\n  migrate(item, collection = null, updateVersionNumber = true) {\n    V.set(item);\n    if (updateVersionNumber) {\n      item.stac_version = LATEST_VERSION;\n    }\n\n    _.ensure(item, 'stac_extensions', []) && DONE;\n    V.before('1.0.0-rc.1') && _.migrateExtensionShortnames(item) && DONE;\n\n    _.ensure(item, 'id', '') && DONE;\n    _.ensure(item, 'type', 'Feature') && DONE;\n    if (!_.isObject(item.geometry)) {\n      item.geometry = null;\n    }\n    if (item.geometry !== null) {\n      _.ensure(item, 'bbox', []) && DONE;\n    }\n    _.ensure(item, 'properties', {}) && DONE;\n    _.ensure(item, 'links', []) && DONE;\n    _.ensure(item, 'assets', {}) && DONE;\n\n    // Migrate Commons extension - part 1\n    let commons = false;\n    if (_.isObject(collection) && _.isObject(collection.properties)) {\n      _.removeFromArray(item, 'stac_extensions', 'commons');\n      item.properties = Object.assign({}, collection.properties, item.properties);\n      commons = true;\n    }\n\n    _.runAll(Item, item, item);\n\n    Fields.migrate(item.properties, item);\n\n    Asset.migrateAll(item);\n\n    // Also populate extensions if commons has been implemented\n    (V.before('0.8.0') || commons) && _.populateExtensions(item, 'item') && DONE;\n\n    return item;\n  }\n\n};\n\nvar CollectionCollection = {\n\n  migrate(object, updateVersionNumber = true) {\n    _.ensure(object, 'collections', []) && DONE;\n    _.ensure(object, 'links', []) && DONE;\n\n    _.runAll(CollectionCollection, object, object);\n\n    object.collections = object.collections.map(collection => Collection.migrate(collection, updateVersionNumber));\n\n    return object;\n  },\n\n};\n\nvar ItemCollection = {\n\n  migrate(itemCollection, updateVersionNumber = true) {\n    _.ensure(itemCollection, 'type', 'FeatureCollection') && DONE;\n    _.ensure(itemCollection, 'features', []) && DONE;\n    _.ensure(itemCollection, 'links', []) && DONE;\n\n    _.runAll(ItemCollection, itemCollection, itemCollection);\n\n    itemCollection.features = itemCollection.features.map(feature => Item.migrate(feature, null, updateVersionNumber));\n\n    return itemCollection;\n  },\n\n};\n\nvar Asset = {\n\n  migrateAll(context, field = 'assets') {\n    for (let key in context[field]) {\n      Asset.migrate(context[field][key], context);\n    }\n  },\n\n  migrate(asset, context) {\n    _.runAll(Asset, asset, context);\n\n    Fields.migrate(asset, context);\n\n    return asset;\n  },\n\n  mediaTypes(asset) {\n    _.is(asset.type, 'string') && _.mapValues(\n      asset, 'type',\n      ['image/vnd.stac.geotiff', 'image/vnd.stac.geotiff; cloud-optimized=true'],\n      ['image/tiff; application=geotiff', 'image/tiff; application=geotiff; profile=cloud-optimized']\n    );\n  }\n\n};\n\nvar Band = {\n\n  migrateAll(obj, context) {\n\n    if (V.before('1.0.0')) { // Not sure when the index-based bands were removed\n      const bands = _.isObject(context.properties) && Array.isArray(context.properties.bands) ? context.properties.bands : [];\n      if (Array.isArray(obj['eo:bands'])) {\n        for (let i in obj['eo:bands']) {\n          let band = obj['eo:bands'][i];\n          if (_.is(band, 'number') && _.isObject(bands[band])) {\n            band = bands[band];\n          }\n          if (!_.isObject(band)) {\n            band = {}; // \"Fix\" invalid band index\n          }\n          obj['eo:bands'][i] = band;\n        }\n      }\n    }\n\n    if (V.before(\"1.1.0-beta.1\") && (Array.isArray(obj[\"raster:bands\"]) || Array.isArray(obj[\"eo:bands\"]))) {\n      _.ensure(obj, \"bands\", []);\n\n      const raster = obj[\"raster:bands\"] || [];\n      const eo = obj[\"eo:bands\"] || [];\n      const length = Math.max(raster.length, eo.length);\n      for (let i = 0; i < length; i++) {\n        _.ensure(obj.bands, i, {});\n        Object.assign(obj.bands[i], raster[i], eo[i]);\n        obj.bands[i] = Band.migrate(obj.bands[i], context);\n      }\n\n      delete obj[\"raster:bands\"];\n      delete obj[\"eo:bands\"];\n    }\n\n  },\n\n  migrate(band, context) {\n    _.runAll(Band, band, context);\n\n    Fields.migrate(band, context);\n\n    return band;\n  },\n\n  eo(band) {\n    if (V.before('2.0.0-beta.1', 'eo')) {\n      _.rename(band, 'common_name', 'eo:common_name') && DONE;\n      _.rename(band, 'center_wavelength', 'eo:center_wavelength') && DONE;\n      _.rename(band, 'full_width_half_max', 'eo:full_width_half_max') && DONE;\n      _.rename(band, 'solar_illumination', 'eo:solar_illumination') && DONE;\n    }\n  },\n\n  raster(band) {\n    if (V.before('2.0.0-beta.1', 'raster')) {\n      _.rename(band, 'sampling', 'raster:sampling') && DONE;\n      _.rename(band, 'bits_per_sample', 'raster:bits_per_sample') && DONE;\n      _.rename(band, 'spatial_resolution', 'raster:spatial_resolution') && DONE;\n      _.rename(band, 'scale', 'raster:scale') && DONE;\n      _.rename(band, 'offset', 'raster:offset') && DONE;\n      _.rename(band, 'histogram', 'raster:histogram') && DONE;\n    }\n  }\n\n};\n\nvar Fields = {\n\n  migrate(obj, context, summaries = false) {\n    _.runAll(Fields, obj, context, summaries);\n\n    return obj;\n  },\n\n  _commonMetadata(obj, context) {\n    // Timestamps must be always in UTC\n    // datetime, start_datetime and end_datetime already required UTC before\n    if (V.before('1.0.0-rc.3')) {\n      _.toUTC(obj, 'created') && DONE;\n      _.toUTC(obj, 'updated') && DONE;\n    }\n\n    Band.migrateAll(obj, context);\n  },\n\n  _timestamps(obj, context) {\n    // Timestamps must be always in UTC\n    _.toUTC(obj, 'published') && DONE;\n    _.toUTC(obj, 'expires') && DONE;\n    _.toUTC(obj, 'unpublished') && DONE;\n\n    _.upgradeExtension(context, SCHEMAS.timestamps);\n  },\n\n  _versioningIndicator(obj, context) {\n    // Nothing to do\n\n    _.upgradeExtension(context, SCHEMAS.version);\n  },\n\n  checksum(obj, context) {\n    if (V.before('0.9.0') && Checksum.multihash) {\n      _.rename(obj, 'checksum:md5', 'checksum:multihash') && Checksum.toMultihash(obj, 'checksum:multihash', 'md5') && DONE;\n      _.rename(obj, 'checksum:sha1', 'checksum:multihash') && Checksum.toMultihash(obj, 'checksum:multihash', 'sha1') && DONE;\n      // We assume sha2/3-256 although that may fail in some cases and other lengths are chosen\n      // Never seen this implemtned in the wild, so let's try this until another use case comes up\n      _.rename(obj, 'checksum:sha2', 'checksum:multihash') && Checksum.toMultihash(obj, 'checksum:multihash', 'sha2-256') && DONE;\n      _.rename(obj, 'checksum:sha3', 'checksum:multihash') && Checksum.toMultihash(obj, 'checksum:multihash', 'sha3-256') && DONE;\n    }\n\n    V.before('1.0.0-rc.1') && _.rename(obj, 'checksum:multihash', 'file:checksum') && _.addExtension(context, SCHEMAS.file) && DONE;\n\n    _.removeExtension(context, 'checksum');\n  },\n\n  classification(obj, context) {\n    if (V.before('1.1.0', 'classification')) {\n      _.forAll(obj, 'classification:classes', o => _.rename(o, 'color-hint', 'color_hint')) && DONE;\n    }\n    if (V.before('2.0.0', 'classification')) {\n      _.forAll(obj, 'classification:classes', o => _.ensure(o, 'name', o.description)) && DONE;\n    }\n\n    _.upgradeExtension(context, SCHEMAS.classification);\n  },\n\n  cube(obj, context) {\n    // We'd need to convert proj strings to something else for v1.0 -> v2.0, but that's unfeasible here.\n    // Nothing else to do here.\n\n    _.upgradeExtension(context, SCHEMAS.datacube);\n  },\n\n  dtr(obj, context) {\n    if (V.before('0.9.0')) {\n      _.rename(obj, 'dtr:start_datetime', 'start_datetime') && DONE;\n      _.rename(obj, 'dtr:end_datetime', 'end_datetime') && DONE;\n      _.removeExtension(context, 'datetime-range') && DONE;\n    }\n  },\n\n  eo(obj, context) {\n    if (V.before('0.9.0')) {\n      _.rename(obj, 'eo:epsg', 'proj:epsg') && _.addExtension(context, SCHEMAS.projection) && DONE;\n      _.rename(obj, 'eo:platform', 'platform') && DONE;\n      _.rename(obj, 'eo:instrument', 'instruments') && _.toArray(obj, 'instruments') && DONE;\n      _.rename(obj, 'eo:constellation', 'constellation') && DONE;\n      _.rename(obj, 'eo:off_nadir', 'view:off_nadir') && _.addExtension(context, SCHEMAS.view) && DONE;\n      _.rename(obj, 'eo:azimuth', 'view:azimuth') && _.addExtension(context, SCHEMAS.view) && DONE;\n      _.rename(obj, 'eo:incidence_angle', 'view:incidence_angle') && _.addExtension(context, SCHEMAS.view) && DONE;\n      _.rename(obj, 'eo:sun_azimuth', 'view:sun_azimuth') && _.addExtension(context, SCHEMAS.view) && DONE;\n      _.rename(obj, 'eo:sun_elevation', 'view:sun_elevation') && _.addExtension(context, SCHEMAS.view) && DONE;\n    }\n\n    V.before('1.0.0-beta.1') && _.rename(obj, 'eo:gsd', 'gsd') && DONE;\n\n    _.upgradeExtension(context, SCHEMAS.eo);\n  },\n\n  file(obj, context, summaries) {\n    _.rename(obj, 'file:bits_per_sample', 'raster:bits_per_sample') && _.addExtension(context, SCHEMAS.raster) && DONE;\n    _.rename(obj, 'file:data_type', 'data_type') && DONE;\n    _.rename(obj, 'file:unit', 'unit') && DONE;\n\n    if (Array.isArray(obj['file:nodata']) && obj['file:nodata'].length > 1) {\n      // In case of more than one no-data value we need to create a custom property\n      // as there's no alternative for multiple no-data values yet\n      _.copy(obj, 'file:nodata', 'nodata:values') && DONE;\n    }\n    _.rename(obj, 'file:nodata', 'nodata') && !summaries && _.pickFirst(obj, 'nodata') && DONE;\n    _.upgradeExtension(context, SCHEMAS.file);\n  },\n\n  label(obj, context) {\n    // Migrate 0.8.0-rc1 non-pluralized forms\n    if (V.before('0.8.0')) {\n      _.rename(obj, 'label:property', 'label:properties') && DONE;\n      _.rename(obj, 'label:task', 'label:tasks') && DONE;\n      _.rename(obj, 'label:overview', 'label:overviews') && _.toArray(obj, 'label:overviews') && DONE;\n      _.rename(obj, 'label:method', 'label:methods') && DONE;\n      _.toArray(obj, 'label:classes') && DONE;\n    }\n\n    _.upgradeExtension(context, SCHEMAS.label);\n  },\n\n  pc(obj, context) {\n    V.before('0.8.0') && _.rename(obj, 'pc:schema', 'pc:schemas') && DONE;\n\n    _.upgradeExtension(context, SCHEMAS.pointcloud);\n  },\n\n  processing(obj, context) {\n    // Nothing to do\n\n    _.upgradeExtension(context, SCHEMAS.processing);\n  },\n\n  proj(obj, context) {\n    _.rename(obj, 'proj:epsg', 'proj:code') && _.formatString(obj, 'proj:code', 'EPSG:{}') && DONE;\n\n    _.upgradeExtension(context, SCHEMAS.projection);\n  },\n\n  raster(obj, context) {\n    _.upgradeExtension(context, SCHEMAS.raster);\n  },\n\n  sar(obj, context, summary) {\n    // Which version have they been (re)moved?\n    _.rename(obj, 'sar:incidence_angle', 'view:incidence_angle') && _.addExtension(context, SCHEMAS.view) && DONE;\n    _.rename(obj, 'sar:pass_direction', 'sat:orbit_state') && _.mapValues(obj, 'sat:orbit_state', [null], ['geostationary']) && _.addExtension(context, SCHEMAS.sat) && DONE;\n\n    if (V.before('0.7.0')) {\n      _.flattenArray(obj, 'sar:resolution', ['sar:resolution_range', 'sar:resolution_azimuth'], summary) && DONE;\n      _.flattenArray(obj, 'sar:pixel_spacing', ['sar:pixel_spacing_range', 'sar:pixel_spacing_azimuth'], summary) && DONE;\n      _.flattenArray(obj, 'sar:looks', ['sar:looks_range', 'sar:looks_azimuth', 'sar:looks_equivalent_number'], summary) && DONE;\n      _.rename(obj, 'sar:off_nadir', 'view:off_nadir') && _.addExtension(context, SCHEMAS.view) && DONE;\n    }\n\n    if (V.before('0.9.0')) {\n      _.rename(obj, 'sar:platform', 'platform') && DONE;\n      _.rename(obj, 'sar:instrument', 'instruments') && _.toArray(obj, 'instruments') && DONE;\n      _.rename(obj, 'sar:constellation', 'constellation') && DONE;\n      _.rename(obj, 'sar:type', 'sar:product_type') && DONE;\n      _.rename(obj, 'sar:polarization', 'sar:polarizations') && DONE;\n      _.flattenOneElementArray(obj, 'sar:absolute_orbit', summary) && _.rename(obj, 'sar:absolute_orbit', 'sat:absolute_orbit') && _.addExtension(context, SCHEMAS.sat) && DONE;\n      _.flattenOneElementArray(obj, 'sar:relative_orbit', summary) && _.rename(obj, 'sar:relative_orbit', 'sat:relative_orbit') && _.addExtension(context, SCHEMAS.sat) && DONE;\n    }\n\n    _.upgradeExtension(context, SCHEMAS.sar);\n  },\n\n  sat(obj, context) {\n    // Migrate 0.9.0-rc _angle suffixes\n    if (V.before('0.9.0')) {\n      _.rename(obj, 'sat:off_nadir_angle', 'sat:off_nadir') && DONE;\n      _.rename(obj, 'sat:azimuth_angle', 'sat:azimuth') && DONE;\n      _.rename(obj, 'sat:sun_azimuth_angle', 'sat:sun_azimuth') && DONE;\n      _.rename(obj, 'sat:sun_elevation_angle', 'sat:sun_elevation') && DONE;\n    }\n\n    _.upgradeExtension(context, SCHEMAS.sat);\n  },\n\n  sci(obj, context) {\n    // Nothing to do\n\n    _.upgradeExtension(context, SCHEMAS.scientific);\n  },\n\n  item(obj) { // Single Item\n    if (V.before('0.8.0')) {\n      _.rename(obj, 'item:license', 'license') && DONE;\n      _.rename(obj, 'item:providers', 'providers') && DONE;\n      // No need to remove the extension from stac_extensions as it was not available before 0.8.0\n    }\n  },\n\n  table(obj, context) {\n    // Nothing to do\n\n    _.upgradeExtension(context, SCHEMAS.table);\n  },\n\n  view(obj, context) {\n    // Nothing to do\n\n    _.upgradeExtension(context, SCHEMAS.view);\n  }\n\n};\n\nvar Migrate = {\n\n  item(item, collection = null, updateVersionNumber = true) {\n    return Item.migrate(item, collection, updateVersionNumber);\n  },\n\n  catalog(catalog, updateVersionNumber = true) {\n    return Catalog.migrate(catalog, updateVersionNumber);\n  },\n\n  collection(collection, updateVersionNumber = true) {\n    return Collection.migrate(collection, updateVersionNumber);\n  },\n\n  collectionCollection(collections, updateVersionNumber = true) {\n    return CollectionCollection.migrate(collections, updateVersionNumber);\n  },\n\n  itemCollection(itemCollection, updateVersionNumber = true) {\n    return ItemCollection.migrate(itemCollection, updateVersionNumber);\n  },\n\n  stac(object, updateVersionNumber = true) {\n    if (object.type === 'Feature') {\n      return Migrate.item(object, null, updateVersionNumber);\n    }\n    else if (object.type === 'FeatureCollection') {\n      return Migrate.itemCollection(object, updateVersionNumber);\n    }\n    else if (object.type === 'Collection' || (!object.type && _.isDefined(object.extent) && _.isDefined(object.license))) {\n      return Migrate.collection(object, updateVersionNumber);\n    }\n    else if (!object.type && Array.isArray(object.collections)) {\n      return Migrate.collectionCollection(object, updateVersionNumber);\n    }\n    else {\n      return Migrate.catalog(object, updateVersionNumber);\n    }\n  },\n\n  enableMultihash(multihash) {\n    Checksum.multihash = multihash;\n  }\n\n};\n\nmodule.exports = Migrate;\n","/* global define */\n(function (root, factory) {\n  /* istanbul ignore next */\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.compareVersions = factory();\n  }\n}(this, function () {\n\n  var semver = /^v?(?:\\d+)(\\.(?:[x*]|\\d+)(\\.(?:[x*]|\\d+)(\\.(?:[x*]|\\d+))?(?:-[\\da-z\\-]+(?:\\.[\\da-z\\-]+)*)?(?:\\+[\\da-z\\-]+(?:\\.[\\da-z\\-]+)*)?)?)?$/i;\n\n  function indexOrEnd(str, q) {\n    return str.indexOf(q) === -1 ? str.length : str.indexOf(q);\n  }\n\n  function split(v) {\n    var c = v.replace(/^v/, '').replace(/\\+.*$/, '');\n    var patchIndex = indexOrEnd(c, '-');\n    var arr = c.substring(0, patchIndex).split('.');\n    arr.push(c.substring(patchIndex + 1));\n    return arr;\n  }\n\n  function tryParse(v) {\n    return isNaN(Number(v)) ? v : Number(v);\n  }\n\n  function validate(version) {\n    if (typeof version !== 'string') {\n      throw new TypeError('Invalid argument expected string');\n    }\n    if (!semver.test(version)) {\n      throw new Error('Invalid argument not valid semver (\\''+version+'\\' received)');\n    }\n  }\n\n  function compareVersions(v1, v2) {\n    [v1, v2].forEach(validate);\n\n    var s1 = split(v1);\n    var s2 = split(v2);\n\n    for (var i = 0; i < Math.max(s1.length - 1, s2.length - 1); i++) {\n      var n1 = parseInt(s1[i] || 0, 10);\n      var n2 = parseInt(s2[i] || 0, 10);\n\n      if (n1 > n2) return 1;\n      if (n2 > n1) return -1;\n    }\n\n    var sp1 = s1[s1.length - 1];\n    var sp2 = s2[s2.length - 1];\n\n    if (sp1 && sp2) {\n      var p1 = sp1.split('.').map(tryParse);\n      var p2 = sp2.split('.').map(tryParse);\n\n      for (i = 0; i < Math.max(p1.length, p2.length); i++) {\n        if (p1[i] === undefined || typeof p2[i] === 'string' && typeof p1[i] === 'number') return -1;\n        if (p2[i] === undefined || typeof p1[i] === 'string' && typeof p2[i] === 'number') return 1;\n\n        if (p1[i] > p2[i]) return 1;\n        if (p2[i] > p1[i]) return -1;\n      }\n    } else if (sp1 || sp2) {\n      return sp1 ? -1 : 1;\n    }\n\n    return 0;\n  };\n\n  var allowedOperators = [\n    '>',\n    '>=',\n    '=',\n    '<',\n    '<='\n  ];\n\n  var operatorResMap = {\n    '>': [1],\n    '>=': [0, 1],\n    '=': [0],\n    '<=': [-1, 0],\n    '<': [-1]\n  };\n\n  function validateOperator(op) {\n    if (typeof op !== 'string') {\n      throw new TypeError('Invalid operator type, expected string but got ' + typeof op);\n    }\n    if (allowedOperators.indexOf(op) === -1) {\n      throw new TypeError('Invalid operator, expected one of ' + allowedOperators.join('|'));\n    }\n  }\n\n  compareVersions.validate = function(version) {\n    return typeof version === 'string' && semver.test(version);\n  }\n\n  compareVersions.compare = function (v1, v2, operator) {\n    // Validate operator\n    validateOperator(operator);\n\n    // since result of compareVersions can only be -1 or 0 or 1\n    // a simple map can be used to replace switch\n    var res = compareVersions(v1, v2);\n    return operatorResMap[operator].indexOf(res) > -1;\n  }\n\n  return compareVersions;\n}));\n"],"names":["compareVersions","LATEST_VERSION","SCHEMAS","EXTENSIONS","itemAndCollection","classification","datacube","eo","file","label","pointcloud","processing","projection","raster","sar","sat","scientific","view","version","timestamps","catalog","collection","item","Object","assign","Ext","parseExtension","url","match","id","match2","V","extensions","set","stac","stac_version","Array","isArray","stac_extensions","ext","e","before","compare","comparator","compareTo","_","type","val","is","includes","isDefined","isObject","obj","rename","oldKey","newKey","copy","forAll","key","fn","i","toArray","flattenArray","newKeys","summary","value","flattenOneElementArray","length","removeFromArray","valueToRemove","index","indexOf","splice","pickFirst","ensure","defaultValue","upgradeExtension","context","extension","findIndex","old","addExtension","newExtension","push","sort","removeExtension","oldExtension","migrateExtensionShortnames","oldShortnames","keys","newSchemas","values","mapValues","populateExtensions","objectsToCheck","assets","concat","item_assets","summaries","properties","links","pop","forEach","bands","prefix","oldValues","newValues","map","mapObject","moveTo","fromSummary","mergedSummary","condition","runAll","migrations","startsWith","toUTC","this","toISOString","error","date","Date","replace","formatString","format","formatter","replaceAll","Checksum","multihash","hexToUint8","hexString","Error","Uint8Array","byte","parseInt","uint8ToHex","bytes","reduce","str","toString","padStart","toMultihash","algo","encoded","encode","console","warn","Catalog","migrate","updateVersionNumber","Collection","spatial","bbox","temporal","interval","extent","min","max","start","end","unshift","count","Math","union","fill","middle","c","collectionAssets","Asset","migrateAll","itemAsset","other_properties","prop","minimum","maximum","filter","v","a","b","find","link","rel","Fields","Item","geometry","commons","CollectionCollection","object","collections","ItemCollection","itemCollection","features","feature","field","asset","mediaTypes","Band","band","_commonMetadata","_timestamps","_versioningIndicator","checksum","o","description","cube","dtr","pc","proj","sci","table","Migrate","collectionCollection","license","enableMultihash","module","exports","root","factory","semver","indexOrEnd","q","split","patchIndex","arr","substring","tryParse","isNaN","Number","validate","TypeError","test","v1","v2","s1","s2","n1","n2","sp1","sp2","p1","p2","undefined","allowedOperators","operatorResMap","validateOperator","op","join","operator","res"],"ignoreList":[],"sourceRoot":""}